<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="x-icon" href="/icons/quizlogo99.svg">
    <link rel="stylesheet" href="/styles/general.css">
    <link rel="stylesheet" href="/styles/header.css">
    <link rel="stylesheet" href="/styles/quiz.css">
    <link rel="stylesheet" href="/styles/logo.css">
    <title>Quiz</title>
</head>
<body>
    <div class="background-image"></div>
    <div class="loading">
        <div class="logo-container">
            <div class="logo-div">
                <div class="top-logo">
                    <div class="Q-box">Q</div>
                    <div class="U-box">U</div>
                </div>
                <div class="bottom-logo">
                    <div class="I-box">I</div>
                    <div class="Z-box">Z</div>
                </div>
            </div>
        </div>
    </div>
    <div class="header hidden">
            <div class="logo-box">
                <a th:href="@{/home}">
                    <img class="logo" src="/icons/quizlogo99.svg" alt="Logo">
                </a>
                    <div class="logo-name">
                    <span class="quiz">QUIZ</span>
                    <span class="game">GAME</span>
                </div>
            </div>
        </a>
        <div class="profile-box">
            <span class="pf-lvl">Lvl - 01</span>
            <div >
                <img class="profile" id="profile" src="/images/space man.jpg" alt="Logo">
            </div>
        </div>
    </div>

    <div class="container hidden">
        <div class="quiz-container">

            <input type="hidden" id="quiz-id" th:value="${quizId}">

            <div class="timer">
                <img src="/icons/stopwatch (1).svg" alt="timer img">
                <span id="timer">00:00</span>
                <span id="next-message" style="display: none; font-size: .7rem;">(Next Question)</span>
            </div>
            <a th:href="@{/quizset}">
                <div id="exit-link" class="exist">
                    <img src="/icons/exit-door.svg" alt="exist icon">
                    <span>Exist</span>
                </div>
            </a>
            <div id="confirmation-overlay" class="hidden">
                <div class="overlay-box">
                    <p>Are you sure you want to exit?</p>
                    <button id="confirm-exit">Yes</button>
                    <button id="cancel-exit">No</button>
                </div>
            </div>
            <div class="remain-question" id="question-number">1 / 8</div>
            <div class="question-box" id="question-box">
                <div class="Q-img" id="question-image">
                    <img src="/images/project-management (1).png" alt="Question image">
                </div>
                <span 
                    class="question" 
                    id="question-text" 
                    th:text="${currentQuestion.question}" 
                    th:attr="data-id=${currentQuestion.questionId}">
                    Question text
                </span>
            </div>
            <div class="answer-box" id="answers">
                <div class="answer click-answer" 
                        onclick="selectAnswer(this)" 
                        th:each="answer, iterStat : ${answers}"
                        th:attr="data-id=${answer.answerId}">
                    <span class="ans-A" th:text="${answerLabels[iterStat.index]} + '.'"></span>
                    <span class="ans-text" th:text="${answer.answer}">Answer</span>
                    <div class="ans-bg"></div>
                </div>              
            </div>
            <button id="next-btn" class="next-btn click-next-btn">NEXT</button>
        </div>
    </div>

    <script src="/scripts/audio.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" integrity="sha512-7eHRwcbYkK4d9g/6tD/mhkf++eoTHwpNM9woBxtPUBWm67zeAfFC+HrdoE2GanKeocly/VxeLvIqwvCdk7qScg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        playBackgroundAudioQuiz();
        clickAnswerAudio(".click-answer");
        clickNextAudio(".click-next-btn");
    </script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        gsap.to(".loading", {
            opacity: 0,
            duration: 0.2,
            delay: 2,
            onComplete: () => {
                const loadingElement = document.querySelector(".loading");
                if (loadingElement) {
                    loadingElement.style.display = "none";
                }

                document.querySelector(".header").classList.remove("hidden");
                document.querySelector(".header").classList.add("visible");
                document.querySelector(".container").classList.remove("hidden");
                document.querySelector(".container").classList.add("visible");
            }
        });
    });

    const exitLink = document.getElementById("exit-link");
    const confirmationOverlay = document.getElementById("confirmation-overlay");
    const confirmExitButton = document.getElementById("confirm-exit");
    const cancelExitButton = document.getElementById("cancel-exit");

    exitLink.addEventListener("click", (event) => {
        event.preventDefault(); 
        confirmationOverlay.classList.remove("hidden");
        pauseTimer();
    });

    confirmExitButton.addEventListener("click", () => {
        window.location.href = "/quizset";
    });

    cancelExitButton.addEventListener("click", () => {
        confirmationOverlay.classList.add("hidden");
        startTimer(); 
    });
</script>
<script>
    document.getElementById("next-btn").addEventListener("click", () => {
    const selectedAnswer = document.querySelector(".answer.selected");
    if (!selectedAnswer) {
        return;
    }

    const quizId = document.getElementById("quiz-id").value; // Get the quiz ID
    const questionId = document.getElementById("question-text").dataset.id;
    const answerId = selectedAnswer.dataset.id; 

    fetch(`/quiz/submit-answer?quizId=${quizId}&questionId=${questionId}&answerId=${answerId}`, {
        method: "POST",
    })
    .then(response => response.json())
    .then(data => {
        console.log("Answer submission:", data);
        if (data.correct) {
            console.log("Correct answer!");
        } else {
            console.log("Wrong answer.");
        }

        // Fetch the next question
        fetch(`/quiz/next-question?quizId=${quizId}&questionId=${questionId}`)
        .then(response => response.json())
        .then(data => {
            if (data.message) { 
            fetch('/quiz/complete')
                .then(response => response.json())
                .then(resultData => {
                    console.log("Quiz completed:", resultData);
                    window.location.href = `/${quizId}/result`;
                })
                .catch(error => console.error("Error completing quiz:", error));
            return;
        }


            const question = data.question;
            const answers = data.answers;

            // Update question and answers
            document.getElementById("question-text").textContent = question.question;
            document.getElementById("question-text").dataset.id = question.questionId;
            const answersContainer = document.getElementById("answers");
            answersContainer.innerHTML = "";

            answers.forEach((answer, index) => {
                const answerElement = document.createElement("div");
                answerElement.classList.add("answer", "click-answer");
                answerElement.setAttribute("data-id", answer.answerId);
                answerElement.setAttribute("onclick", "selectAnswer(this)");
                answerElement.innerHTML = `
                    <span class="ans-A">${["A", "B", "C", "D"][index]}.</span>
                    <span class="ans-text">${answer.answer}</span>
                `;
                answersContainer.appendChild(answerElement);
            });

            // Update question counter
            const questionCounter = document.getElementById("question-number");
            const currentCount = parseInt(questionCounter.textContent.split(" / ")[0]);
            questionCounter.textContent = `${currentCount + 1} / 8`; 
        })
        .catch(error => console.error("Error fetching next question:", error));
    })
    .catch(error => console.error("Error submitting answer:", error));
});

</script>
    <!-- <script>
        document.getElementById("next-btn").addEventListener("click", () => {
    const selectedAnswer = document.querySelector(".answer.selected");
    if (!selectedAnswer) {
       // alert("Please select an answer before proceeding to the next question.");
        return;
    }

    const questionId = document.getElementById("question-text").dataset.id;
    const answerId = selectedAnswer.dataset.id; // Get answerId from the selected answer

    // Submit the answer
    fetch(`/quiz/submit-answer?questionId=${questionId}&answerId=${answerId}`, {
        method: "POST",
    })
        .then((response) => response.json())
        .then((data) => {
            console.log("Answer submission:", data);
            if (data.correct) {
                console.log("Correct answer!");
            } else {
                console.log("Wrong answer.");
            }

            // Fetch the next question
            fetch(`/quiz/next-question?questionId=${questionId}`)
                .then((response) => response.json())
                .then((data) => {
                    if (data.message) {
                        window.location.href = "/result"; // Redirect to result page
                        return;
                    }

                    const question = data.question;
                    const answers = data.answers;

                    // Update question and answers
                    document.getElementById("question-text").textContent = question.question;
                    document.getElementById("question-text").dataset.id = question.questionId;
                    const answersContainer = document.getElementById("answers");
                    answersContainer.innerHTML = "";

                    answers.forEach((answer, index) => {
                        const answerElement = document.createElement("div");
                        answerElement.classList.add("answer");
                        answerElement.classList.add("click-answer");
                        answerElement.setAttribute("data-id", answer.answerId); // Add data-id for the answer
                        answerElement.setAttribute("onclick", "selectAnswer(this)");
                        answerElement.innerHTML = `
                            <span class="ans-A">${["A", "B", "C", "D"][index]}.</span>
                            <span class="ans-text">${answer.answer}</span>
                        `;
                        clickAnswerAudio(".click-answer");
                        answersContainer.appendChild(answerElement);
                        clickAnswerAudio(".click-answer");
                    });
                                // Update question counter
                    const questionCounter = document.getElementById("question-number");
                    const currentCount = parseInt(questionCounter.textContent.split(" / ")[0]);
                    questionCounter.textContent = `${currentCount + 1} / 8`; // Update the question number
                })
                .catch((error) => console.error("Error fetching next question:", error));
        })
        .catch((error) => console.error("Error submitting answer:", error));
});

    </script> -->
<script>
    function selectAnswer(selectedElement) {
        const allAnswers = document.querySelectorAll('.answer');
        allAnswers.forEach(answer => {
            answer.classList.remove('selected');
        });

        selectedElement.classList.add('selected');
    }
</script>
<script>
    let timeLeft = 33; // Time in seconds for each question
    let timerInterval;
    const timerElement = document.getElementById("timer");
    const nextMessageElement = document.getElementById("next-message");
    const questionBoxElement = document.getElementById("question-box");

    function updateTimer() {
        const minutes = String(Math.floor(timeLeft / 60)).padStart(2, '0');
        const seconds = String(timeLeft % 60).padStart(2, '0');
        timerElement.textContent = `${minutes}:${seconds}`;

        // Show "Move to next question" when time is < 5s
        if (timeLeft < 6) {
            nextMessageElement.style.display = "inline"; // Show the message
            questionBoxElement.classList.add("warning");
            timerAudio();
        } else {
            nextMessageElement.style.display = "none"; // Hide otherwise
            questionBoxElement.classList.remove("warning");
        }

        if (timeLeft > -1) {
            timeLeft--;
        } else {
            clearInterval(timerInterval);
            timerElement.textContent = "Time's up!";
            document.getElementById("next-btn").click(); // Auto-click next button
        }
    }

    function startTimer(time) {
        clearInterval(timerInterval); // Ensure no duplicate intervals
        timeLeft = time; // Reset timer
        nextMessageElement.style.display = "none"; // Hide message when starting
        timerInterval = setInterval(updateTimer, 1000);
        updateTimer();
    }

    function pauseTimer() {
        clearInterval(timerInterval);
    }

    function resetTimer() {
        pauseTimer();
        timeLeft = 30;
        nextMessageElement.style.display = "none"; // Hide message on reset
        updateTimer();
    }

    // Start timer when page loads
    document.addEventListener("DOMContentLoaded", () => startTimer(12));

    // Reset timer when user clicks "Next"
    document.getElementById("next-btn").addEventListener("click", () => {
        startTimer(12); // Restart the timer for the new question
    });
</script>

</body>
</html>




